
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String            @id @default(cuid())

  username            String
  email               String            @unique
  password            String

  habits             Habit[]

  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
}         

model Habit           {
  id                  String            @id @default(cuid())
  userId              String

  name                String
  description         String?
  frequencyType       FrequencyType     @default(DAILY)
  targetPerWeek       Int?
  archived            Boolean           @default(false)

  user               User              @relation(fields: [userId], references: [id])
  entries            HabitEntry[]
  schedules          HabitSchedule[]
  streak             Streak?

  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt

}

model HabitEntry {
  id                  String            @id @default(cuid())
  habitId             String

  date                DateTime
  count               Int               @default(1)

  habit               Habit             @relation(fields: [habitId], references: [id])
  
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt

  @@unique([habitId, date])
}

model HabitSchedule {
  id                  String            @id @default(cuid())
  habitId             String            

  dayOfWeek           Int               // 0 (Sunday) to 6 (Saturday)
  isActive            Boolean           @default(true)

  habit               Habit             @relation(fields: [habitId], references: [id])

  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt

}

model Streak {
  id                  String            @id @default(cuid())
  habitId             String            @unique

  currentStreak      Int                @default(0)
  longestStreak      Int                @default(0)
  lastCompletedAt    DateTime?

  habit               Habit             @relation(fields: [habitId], references: [id])

  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
}

enum FrequencyType {
  DAILY
  WEEKLY
  MONTHLY
}